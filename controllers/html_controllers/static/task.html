<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Manager</title>
  <style>
    /* Reset and base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #e8dbdb; color: #333; padding: 20px; }

    h1, h2 { margin-bottom:5px; color: #444; font-size: 20px;}
    h1 { font-size:25px; margin-bottom:5px; }

    /* Form styling */
    form { display: flex; flex-wrap: wrap; gap: 10px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    form input, form select, form button {
      padding: 10px 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    form input:focus, form select:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 5px rgba(0,123,255,0.3);
    }
    form button {
      background-color: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }
    form button:hover { background-color: #0056b3; }

    /* Table styling */
    table { width: 100%; border-collapse: collapse; margin-top: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    th, td { padding: 5px 15px; text-align: left; }
    th { background-color: #007bff; color: #fff; font-weight: 600; }
    tr { background: #fff; transition: 0.2s;border-bottom: 1px solid rgb(114, 246, 128); }
    tr:hover { background: #f1f7ff; }

    /* Buttons in table */
    td button {
      padding: 6px 12px;
      font-size: 0.9rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }
    td button:first-child { background: #ffc107; color: #fff; margin-right: 5px; }
    td button:first-child:hover { background: #e0a800; }
    td button:last-child { background: #dc3545; color: #fff; }
    td button:last-child:hover { background: #b02a37; }

    /* Responsive */
    @media (max-width: 768px) {
      form { flex-direction: column; }
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { display: none; }
      td { position: relative; padding-left: 50%; margin-bottom: 10px; }
      td::before {
        content: attr(data-label);
        position: absolute;
        left: 15px;
        top: 12px;
        font-weight: bold;
        color: #007bff;
      }
    }
  </style>
</head>
<body>
  <h1>Task Manager</h1>

  <h2>Create Task</h2>
  <form id="taskForm">
    <input type="text" id="taskName" placeholder="Task Name" required>
    <input type="text" id="description" placeholder="Description">
    <select id="status">
      <option value="pending">Pending</option>
      <option value="in-progress">In Progress</option>
      <option value="completed">Completed</option>
    </select>
    <input type="date" id="dueDate">
    <button type="submit">Add Task</button>
  </form>

  <h2>Tasks</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Status</th>
        <th>Due Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="taskTable">
      <!-- Tasks will be added here -->
    </tbody>
  </table>
  <h2 id="alert" style="position: absolute;top: 50px;left:40%;">hello</h2>
  <script>
    const API_URL = "/html/task"; // Replace with your route

    const taskForm = document.getElementById("taskForm");
    const taskTable = document.getElementById("taskTable");

    async function loadTasks() {
      const res = await fetch(API_URL);
      const data = await res.json();
      taskTable.innerHTML = "";
      if (data.success && data.tasks) {
        data.tasks.forEach(task => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td data-label="Name">${task.taskName}</td>
            <td data-label="Description">${task.description || ''}</td>
            <td data-label="Status">${task.status}</td>
            <td data-label="Due Date">${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}</td>
            <td data-label="Actions">
              <button onclick="editTask('${task._id}')">Edit</button>
              <button onclick="deleteTask('${task._id}')">Delete</button>
            </td>
          `;
          taskTable.appendChild(row);
        });
      }
    }

    taskForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const taskName = document.getElementById("taskName").value;
      const description = document.getElementById("description").value;
      const status = document.getElementById("status").value;
      const dueDate = document.getElementById("dueDate").value;

      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ taskName, description, status, dueDate })
      });
      const data = await res.json();
      NewAlert(data.message);
      taskForm.reset();
      loadTasks();
    });

    async function deleteTask(id) {
      if (!confirm("Are you sure you want to delete this task?")) return;
      const res = await fetch(API_URL, {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id })
      });
      const data = await res.json();
      alert(data.message);
      loadTasks();
    }

    async function editTask(id) {
      const taskRes = await fetch(API_URL);
      const taskData = await taskRes.json();
      const task = taskData.tasks.find(t => t._id === id);
      if (!task) return alert("Task not found");

      const newTaskName = prompt("Task Name:", task.taskName);
      const newDescription = prompt("Description:", task.description || '');
      const newStatus = prompt("Status (pending, in-progress, completed):", task.status);
      const newDueDate = prompt("Due Date (YYYY-MM-DD):", task.dueDate ? task.dueDate.slice(0,10) : '');

      const res = await fetch(API_URL, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, taskName: newTaskName, description: newDescription, status: newStatus, dueDate: newDueDate })
      });
      const data = await res.json();
      alert(data.message);
      loadTasks();
    }
    loadTasks();
    async function NewAlert(data,color='green'){
        document.getElementById("alert").style.display='block'
        document.getElementById("alert").style.color=color
        document.getElementById("alert").innerText=data
        setTimeout(()=>{
            document.getElementById("alert").style.display='none'
        },3000)
    }
  </script>
</body>
</html>
